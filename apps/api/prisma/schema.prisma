generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum VehicleType {
  BUS
  VAN
}

enum InfraType {
  FLOOD
  WORKS
  PAVEMENT_ISSUE
  OTHER
}

model Vehicle {
  id        String   @id @default(cuid())
  plate     String   @unique
  type      VehicleType
  capacity  Int
  active    Boolean  @default(true)
  trips     Trip[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Stop {
  id            String         @id @default(cuid())
  name          String         @unique
  latitude      Float
  longitude     Float
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  demandMetrics DemandMetric[]
}

model Route {
  id        String   @id @default(cuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  trips     Trip[]
}

model Trip {
  id                 String   @id @default(cuid())
  vehicleId          String
  routeId            String
  startTime          DateTime
  endTime            DateTime?
  kilometersPlanned  Float
  kilometersExecuted Float    @default(0)
  scheduleCompliance Float    @default(0) // 0..1
  routeDeviations    Int      @default(0)
  occupancyAverage   Float?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  vehicle       Vehicle        @relation(fields: [vehicleId], references: [id])
  route         Route          @relation(fields: [routeId], references: [id])
  demandMetrics DemandMetric[]
  drivingMetrics DrivingMetric[]
}

model DemandMetric {
  id                 String   @id @default(cuid())
  tripId             String
  stopId             String?
  passengersBoarded  Int      @default(0)
  passengersAlighted Int      @default(0)
  occupancySegment   Float?
  createdAt          DateTime @default(now())

  trip Trip  @relation(fields: [tripId], references: [id])
  stop Stop? @relation(fields: [stopId], references: [id])
}

model DrivingMetric {
  id                String   @id @default(cuid())
  tripId            String
  harshBraking      Int      @default(0)
  harshAcceleration Int      @default(0)
  sharpTurns        Int      @default(0)
  createdAt         DateTime @default(now())

  trip Trip @relation(fields: [tripId], references: [id])
}

model InfrastructureEvent {
  id          String    @id @default(cuid())
  time        DateTime
  latitude    Float
  longitude   Float
  type        InfraType
  description String?
  createdAt   DateTime  @default(now())
}


